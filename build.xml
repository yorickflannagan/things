<?xml version = "1.0" encoding = "UTF-8" standalone = "no"?>
<!--
	Requires gtx-env
	for debug call DEBUG=1
	Required environment:
		JDIGESTER_JAR: JDigester
		JSNMP_JAR: SNMP4J
-->
<project basedir = "." default = "build" name = "things">
	<target name = "init">
		<tstamp />

		<property environment = "env"/>

		<property name = "package.version" value = "1.1.4" />
		<property name = "src.dir" value = "java" />
		<property name = "bin.dir" value = "java-bin" />
		<condition property = "dist.dir" value = "dist/debug" else = "dist/release">
			<and>
				<equals arg1="${DEBUG}" arg2="1" />
				<isset property="DEBUG" />
			</and>
		</condition>
		<property name = "target.file" value = "things-${package.version}.jar" />
		<condition property = "javac.debug" value = "true" else = "false">
			<and>
				<equals arg1="${DEBUG}" arg2="1" />
				<isset property="DEBUG" />
			</and>
		</condition>
		<property name = "debug.level" value = "source,lines,vars" />
		<property name = "target" value = "1.7"/>
		<property name = "source" value = "1.7"/>

		<path id = "project.dependencies">
			<pathelement path = "${env.JDIGESTER_JAR}" />
			<pathelement path = "${env.JSNMP_JAR}" />
		</path>
		<property name = "project.classpath" refid = "project.dependencies" />
		<property name = "project.resources" value = "${env.CRYPTHINGS}/docs/config.xsd" />
	</target>

	<target name = "check" depends = "init">
		<echo message = "package.version"> ${package.version} </echo>
		<echo message = "src.dir"> ${src.dir} </echo>
		<echo message = "bin.dir"> ${bin.dir} </echo>
		<echo message = "dist.dir"> ${dist.dir} </echo>
		<echo message = "target.file"> ${target.file} </echo>
		<echo message = "javac.debug"> ${javac.debug} </echo>
		<echo message = "debug.level"> ${debug.level} </echo>
		<echo message = "target"> ${target} </echo>
		<echo message = "source"> ${source} </echo>
		<echo message = "project.classpath"> ${project.classpath} </echo>
		<echo message = "project.resources"> ${project.resources} </echo>

		<mkdir dir = "${bin.dir}" />
	</target>

	<target name = "clean" depends = "init">
		<delete dir = "${bin.dir}" />
		<delete file = "${dist.dir}/${target.file}" />
		<delete file = "${dist.dir}/things.jar" />
	</target>

	<target name = "compile" depends = "check">
		<javac	debug = "${javac.debug}"
				debuglevel = "${debug.level}"
				srcdir = "${src.dir}"
				destdir = "${bin.dir}"
				classpath = "${project.classpath}"
				source = "${source}"
				target = "${target}"
				includeantruntime = "false" />
	</target>

	<target name = "build" depends = "compile">
		<jar destfile = "${dist.dir}/${target.file}" level = "9" strict = "fail" >
			<fileset dir = "${bin.dir}" />
			<fileset file = "${project.resources}" />
			<manifest>
				<attribute name = "Implementation-Title" value = "Things Utilities" />
				<attribute name = "Implementation-Vendor" value = "The Crypthing Initiative" />
				<attribute name = "Implementation-Version" value = "${package.version} ${TODAY}" />
			</manifest>
		</jar>
		<exec executable="ln" os="Linux">
			<arg line="-s ${dist.dir}/${target.file} ${dist.dir}/things.jar"/>
		</exec>
	</target>
</project>
